<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√öltimos Movimientos - Billetera Digital</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        
        .container {
            max-width: 650px;
            margin: 0 auto;
        }
        
        .transactions-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .back-btn:hover {
            transform: translateX(-5px);
        }
        
        h2 {
            color: #333;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        .transactions-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 35px;
        }
        
        .balance-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
            color: white;
        }
        
        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .balance-value {
            font-size: 32px;
            font-weight: 700;
        }
        
        .filter-section {
            margin-bottom: 20px;
        }
        
        .filter-section label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }
        
        .form-select {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .transaction-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .transaction-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .transaction-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .transaction-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }
        
        .transaction-icon.deposit {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .transaction-icon.transfer {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        
        .transaction-icon.compra {
            background: linear-gradient(135deg, #ffc107, #ff9800);
        }
        
        .transaction-details h6 {
            margin: 0;
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }
        
        .transaction-details p {
            margin: 0;
            font-size: 12px;
            color: #888;
        }
        
        .amount {
            font-weight: 700;
            font-size: 18px;
            margin: 0;
        }
        
        .amount.positive {
            color: #28a745;
        }
        
        .amount.negative {
            color: #dc3545;
        }
        
        .transaction-extra {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
            font-size: 13px;
            color: #666;
        }
        
        .transaction-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .badge-deposit {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-transfer {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-compra {
            background: #fff3cd;
            color: #856404;
        }
        
        .btn-menu {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 14px;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s ease;
        }
        
        .btn-menu:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .stat-value.income {
            color: #28a745;
        }
        
        .stat-value.expense {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" id="backBtn">‚Üê Atr√°s</button>
        
        <div class="transactions-card">
            <div class="transactions-icon">üìä</div>
            <h2>√öltimos Movimientos</h2>
            
            <div class="balance-summary">
                <div class="balance-label">Saldo actual</div>
                <div class="balance-value" id="currentBalance">$0.00</div>
            </div>
            
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-label">Total Ingresos</div>
                    <div class="stat-value income" id="totalIncome">$0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Egresos</div>
                    <div class="stat-value expense" id="totalExpense">$0.00</div>
                </div>
            </div>
            
            <!-- Filtro por tipo de movimiento -->
            <div class="filter-section">
                <label for="filterType">Filtrar por tipo de movimiento:</label>
                <select class="form-select" id="filterType">
                    <option value="all">Todos los movimientos</option>
                    <option value="deposit">Dep√≥sitos</option>
                    <option value="transfer">Transferencias</option>
                    <option value="compra">Compras</option>
                </select>
            </div>
            
            <div id="transactionsList"></div>
            
            <button class="btn btn-primary btn-menu" id="menuBtn">Volver al Men√∫ Principal</button>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            if (!localStorage.getItem('isLoggedIn')) {
                window.location.href = 'login.html';
                return;
            }
            
            const balance = parseFloat(localStorage.getItem('balance')) || 15420.50;
            $('#currentBalance').text(`$${balance.toFixed(2)}`);
            
            // Lista de transacciones (obtener de localStorage o usar ficticias)
            let listaTransacciones = JSON.parse(localStorage.getItem('transactions') || '[]');
            
            // Si no hay transacciones, agregar algunas ficticias
            if (listaTransacciones.length === 0) {
                listaTransacciones = [
                    {
                        type: 'deposit',
                        amount: 5000,
                        date: new Date(Date.now() - 86400000).toISOString(),
                        description: 'Dep√≥sito inicial',
                        previousBalance: 10420.50,
                        newBalance: 15420.50
                    },
                    {
                        type: 'compra',
                        amount: -850,
                        date: new Date(Date.now() - 172800000).toISOString(),
                        description: 'Compra en Supermercado',
                        comercio: 'Walmart',
                        previousBalance: 11270.50,
                        newBalance: 10420.50
                    },
                    {
                        type: 'transfer',
                        amount: -1500,
                        date: new Date(Date.now() - 259200000).toISOString(),
                        description: 'Transferencia a Juan P√©rez',
                        recipient: 'Juan P√©rez',
                        cbu: '0340099812345678901234',
                        message: 'Pago de cena',
                        previousBalance: 12770.50,
                        newBalance: 11270.50
                    },
                    {
                        type: 'deposit',
                        amount: 3000,
                        date: new Date(Date.now() - 345600000).toISOString(),
                        description: 'Dep√≥sito a cuenta',
                        previousBalance: 9770.50,
                        newBalance: 12770.50
                    },
                    {
                        type: 'compra',
                        amount: -420,
                        date: new Date(Date.now() - 432000000).toISOString(),
                        description: 'Compra online',
                        comercio: 'MercadoLibre',
                        previousBalance: 10190.50,
                        newBalance: 9770.50
                    }
                ];
                localStorage.setItem('transactions', JSON.stringify(listaTransacciones));
            }
            
            // Funci√≥n para obtener el tipo de transacci√≥n en formato legible
            function getTipoTransaccion(tipo) {
                const tipos = {
                    'deposit': 'Dep√≥sito',
                    'transfer': 'Transferencia',
                    'compra': 'Compra'
                };
                return tipos[tipo] || tipo;
            }
            
            // Funci√≥n para formatear fecha
            function formatDate(dateStr) {
                const date = new Date(dateStr);
                const now = new Date();
                const diff = now - date;
                const days = Math.floor(diff / 86400000);
                
                if (days === 0) return 'Hoy';
                if (days === 1) return 'Ayer';
                if (days < 7) return `Hace ${days} d√≠as`;
                
                return date.toLocaleDateString('es-ES', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric' 
                });
            }
            
            // Calcular estad√≠sticas con jQuery
            function calcularEstadisticas() {
                let totalIncome = 0;
                let totalExpense = 0;
                
                listaTransacciones.forEach(t => {
                    if (t.type === 'deposit') {
                        totalIncome += t.amount;
                    } else {
                        totalExpense += Math.abs(t.amount);
                    }
                });
                
                $('#totalIncome').text(`$${totalIncome.toFixed(2)}`);
                $('#totalExpense').text(`$${totalExpense.toFixed(2)}`);
            }
            
            // Funci√≥n para mostrar √∫ltimos movimientos con jQuery
            function mostrarUltimosMovimientos(filtro = 'all') {
                const filtered = filtro === 'all' 
                    ? listaTransacciones 
                    : listaTransacciones.filter(t => t.type === filtro);
                
                if (filtered.length === 0) {
                    $('#transactionsList').html(`
                        <div class="empty-state">
                            <div style="font-size: 70px; margin-bottom: 20px;">üì≠</div>
                            <h5>No hay movimientos</h5>
                            <p>No tienes transacciones en esta categor√≠a</p>
                        </div>
                    `);
                    return;
                }
                
                let html = '';
                
                filtered.forEach(t => {
                    const isPositive = t.amount > 0;
                    const iconMap = {
                        'deposit': 'üí∞',
                        'transfer': 'üì§',
                        'compra': 'üõí'
                    };
                    const icon = iconMap[t.type] || 'üí≥';
                    const amountClass = isPositive ? 'positive' : 'negative';
                    const sign = isPositive ? '+' : '';
                    
                    let extraInfo = '';
                    if (t.type === 'transfer' && t.recipient) {
                        extraInfo = `
                            <div class="transaction-extra">
                                <strong>Destinatario:</strong> ${t.recipient}<br>
                                ${t.cbu ? `<strong>CBU:</strong> ${t.cbu}<br>` : ''}
                                ${t.message ? `<strong>Mensaje:</strong> ${t.message}` : ''}
                            </div>
                        `;
                    } else if (t.type === 'compra' && t.comercio) {
                        extraInfo = `
                            <div class="transaction-extra">
                                <strong>Comercio:</strong> ${t.comercio}
                            </div>
                        `;
                    } else if (t.type === 'deposit') {
                        extraInfo = `
                            <div class="transaction-extra">
                                <strong>Saldo anterior:</strong> $${(t.previousBalance || 0).toFixed(2)}<br>
                                <strong>Saldo nuevo:</strong> <span style="color: #28a745; font-weight: 600;">$${(t.newBalance || 0).toFixed(2)}</span>
                            </div>
                        `;
                    }
                    
                    html += `
                        <div class="transaction-item">
                            <div class="transaction-header">
                                <div class="d-flex align-items-center flex-grow-1">
                                    <div class="transaction-icon ${t.type}">
                                        ${icon}
                                    </div>
                                    <div class="transaction-details">
                                        <h6>${t.description}</h6>
                                        <p>${formatDate(t.date)} ‚Ä¢ ${new Date(t.date).toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}</p>
                                        <span class="transaction-type-badge badge-${t.type}">
                                            ${getTipoTransaccion(t.type)}
                                        </span>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <p class="amount ${amountClass}">${sign}$${Math.abs(t.amount).toFixed(2)}</p>
                                </div>
                            </div>
                            ${extraInfo}
                        </div>
                    `;
                });
                
                $('#transactionsList').html(html);
            }
            
            // Evento change en el filtro con jQuery
            $('#filterType').on('change', function() {
                const filtro = $(this).val();
                mostrarUltimosMovimientos(filtro);
            });
            
            // Bot√≥n atr√°s con jQuery
            $('#backBtn').on('click', function() {
                window.location.href = 'menu.html';
            });
            
            $('#menuBtn').on('click', function() {
                window.location.href = 'menu.html';
            });
            
            // Inicializar
            calcularEstadisticas();
            mostrarUltimosMovimientos();
        });
    </script>
</body>
</html>